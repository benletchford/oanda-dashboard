(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{106:function(e,t,a){e.exports=a(265)},111:function(e,t,a){},245:function(e,t,a){},265:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(15),o=a.n(s),c=(a(111),a(26)),i=a(27),u=a(29),l=a(28),d=a(30),p=a(101),h=a.n(p),v=a(102),m=a.n(v),f=a(103),y=a.n(f),w=a(60),b=a.n(w),g=a(104),E=a.n(g),D=a(105),O=a.n(D),k=a(58),j=a.n(k),I=a(18),S=a.n(I),x=a(36),P=a.n(x),C=a(25),B=a.n(C),M=a(59),W=a.n(M),T=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={rows:Object.keys(e.store.accessData).length||1},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){for(var e=this,t=[],a=function(a){e.props.store.accessData[a]||(e.props.store.accessData[a]={env:"live"}),t.push(r.a.createElement("div",{style:{display:"flex"},key:a},r.a.createElement(P.a,{required:!0,defaultValue:e.props.store.accessData[a]?e.props.store.accessData[a].accessToken:"",onChange:function(t){return e.props.store.accessData[a].accessToken=t.target.value},label:"Account Access Token",style:{width:"100%"}}),r.a.createElement(P.a,{required:!0,defaultValue:e.props.store.accessData[a]?e.props.store.accessData[a].accountId:"",onChange:function(t){return e.props.store.accessData[a].accountId=t.target.value},label:"Account ID",style:{width:"100%"}}),r.a.createElement(P.a,{required:!0,defaultValue:e.props.store.accessData[a]?e.props.store.accessData[a].env:"",onChange:function(t){return e.props.store.accessData[a].env=t.target.value},label:"Env",style:{width:"100%"}})))},n=0;n<this.state.rows;n++)a(n);return r.a.createElement(B.a,null,r.a.createElement("div",{style:{padding:"10px"}},r.a.createElement(P.a,{required:!0,defaultValue:this.props.store.name?this.props.store.name:"",onChange:function(t){return e.props.store.name=t.target.value},label:"Dashboard Name",style:{width:"100%"}})),r.a.createElement("div",{style:{padding:"10px"}},t),r.a.createElement("div",{style:{display:"flex",padding:"10px"}},r.a.createElement(W.a,{variant:"contained",color:"primary",style:{width:"100%",marginRight:"5px"},onClick:function(t){return e.setState(Object.assign(e.state,{rows:e.state.rows+1}))}},"Add row"),r.a.createElement(W.a,{variant:"contained",color:"secondary",style:{width:"100%",marginLeft:"5px"},onClick:function(t){e.state.rows>1&&(e.setState(Object.assign(e.state,{rows:e.state.rows-1})),e.props.store.accessData.pop())}},"Remove row")))}}]),t}(n.Component),R=a(35),A=(a(245),a(99)),L=a(100),z=a.n(L);function U(e,t){var a,n,r=Math.floor(1e3*Math.random()*2+1);return(a=r,new Promise(function(e){setTimeout(e.bind(null,n),a)})).then(function(){return function e(t,a,n){return fetch(t,a).then(function(e){if(!e.ok)throw Error(e.statusText);return e}).catch(function(r){if(1===n)throw r;return e(t,a,n-1)})}(e,{headers:{Authorization:"Bearer ".concat(t)}},5).then(function(e){return e.json()})})}function H(e){return"practice"===e?"https://api-fxpractice.oanda.com":"live"===e?"https://api-fxtrade.oanda.com":void 0}function N(e){return Promise.all(e.map(function(e){return function(e){return U("".concat(H(e.env),"/v3/accounts/").concat(e.accountId,"/transactions"),e.accessToken).then(function(t){return Promise.all(t.pages.map(function(t){return U(t,e.accessToken).then(function(e){return e.transactions})})).then(function(e){var t=[];return e.forEach(function(e){return t=t.concat(e)}),t})})}(e)})).then(function(e){var t=[];return e.forEach(function(e){return t=t.concat(e)}),t})}function V(e){return Promise.all(e.map(function(e){return function(e){return U("".concat(H(e.env),"/v3/accounts/").concat(e.accountId,"/summary"),e.accessToken)}(e)}))}var q=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={data:null},a.updateWindowDimensions=a.updateWindowDimensions.bind(Object(R.a)(Object(R.a)(a))),a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"update",value:function(){var e=this;return Promise.all([N(this.props.store.accessData).then(function(e){var t={};e.forEach(function(e){if("ORDER_FILL"===e.type){var a=A(e.time).format("YYYY-MM-DD");void 0===t[a]&&(t[a]=[]),t[a].push(+e.pl)}});var a={};Object.keys(t).forEach(function(e){a[e]=t[e].reduce(function(e,t){return e+t},0)});var n=[];Object.keys(t).sort().forEach(function(e){n.push({x:e,y:Math.round(100*a[e])/100})});var r=[],s=0;return Object.keys(t).sort().forEach(function(e){var t=s+a[e];s=t,r.push({x:e,y:Math.round(100*t)/100})}),{name:"balance",profitByDay:n,cumulativeProfitByDay:r}}),V(this.props.store.accessData).then(function(e){return{name:"nav",nav:Math.round(100*e.map(function(e){return+e.account.pl+ +e.account.unrealizedPL}).reduce(function(e,t){return e+t},0))/100}})]).then(function(e){var t={};return e.forEach(function(e){t[e.name]=e,delete t[e.name].name}),t}).then(function(t){e.setState(Object.assign(e.state,{data:[{name:"Balance",x:t.balance.cumulativeProfitByDay.map(function(e){return e.x}),y:t.balance.cumulativeProfitByDay.map(function(e){return e.y}),mode:"lines"},{name:"NAV",line:{color:"rgb(0, 194, 0)"},x:[t.balance.cumulativeProfitByDay[t.balance.cumulativeProfitByDay.length-2].x,t.balance.cumulativeProfitByDay[t.balance.cumulativeProfitByDay.length-1].x],y:[t.balance.cumulativeProfitByDay[t.balance.cumulativeProfitByDay.length-2].y,t.nav.nav]}]})),document.title=e.props.store.name+": "+t.nav.nav})}},{key:"makeUpdateInterval",value:function(e){var t=this;clearInterval(this.updateInteval),0!==e&&(this.updateInteval=setInterval(function(){t.update()},1e3*e))}},{key:"componentWillReceiveProps",value:function(e){this.makeUpdateInterval(e.updateIntevalSeconds)}},{key:"componentDidMount",value:function(){this.update(),this.makeUpdateInterval(this.props.updateIntevalSeconds),this.updateWindowDimensions(),window.addEventListener("resize",this.updateWindowDimensions)}},{key:"render",value:function(){return r.a.createElement("div",{style:{width:"100%",height:"100%"}},!this.state.data&&r.a.createElement("div",{style:{textAlign:"center",margin:"25px"}},"Loading..."),this.state.data&&r.a.createElement(B.a,null,r.a.createElement(z.a,{data:this.state.data,layout:{autosize:!0,title:this.props.store.name,height:this.state.windowHeight-64,showlegend:!1},useResizeHandler:!0,style:{width:"100%"}})))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateWindowDimensions),clearInterval(this.updateInteval)}},{key:"updateWindowDimensions",value:function(){this.setState(Object.assign(this.state,{windowWidth:window.innerWidth,windowHeight:window.innerHeight}))}}]),t}(n.Component);function J(e){return btoa(unescape(encodeURIComponent(JSON.stringify(e))))}var Y=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(l.a)(t).call(this,e))).store={accessData:[],name:""},a.state={page:"setup",updateIntevalSeconds:0},a}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentWillMount",value:function(){var e;window.location.hash&&(this.store=(e=window.location.hash.substring(1),JSON.parse(decodeURIComponent(escape(window.atob(e))))),this.setState(Object.assign(this.state,{page:"dashboard",updateIntevalSeconds:this.store.updateIntevalSeconds||this.state.updateIntevalSeconds})))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(h.a,{position:"static"},r.a.createElement(m.a,null,r.a.createElement(y.a,{variant:"title",color:"inherit"},"setup"===this.state.page&&"Oanda Dashboard Setup","dashboard"===this.state.page&&"Oanda Dashboard"),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement("div",null,"setup"===this.state.page&&r.a.createElement(b.a,{style:{color:"white"},onClick:function(t){for(var a=!1,n=0;n<e.store.accessData.length;n++)e.store.accessData[n].accessToken&&e.store.accessData[n].accountId&&e.store.accessData[n].env||(t.preventDefault(),a=!0);e.store.name||(t.preventDefault(),a=!0),a||(window.location.hash=J(e.store),e.setState(Object.assign(e.state,{page:"dashboard"})))}},r.a.createElement(E.a,null)),"dashboard"===this.state.page&&r.a.createElement("div",null,r.a.createElement(j.a,{value:this.state.updateIntevalSeconds,onChange:function(t){e.store.updateIntevalSeconds=t.target.value,window.location.hash=J(e.store),e.setState(Object.assign(e.state,{updateIntevalSeconds:t.target.value}))}},r.a.createElement(S.a,{value:0},"Never"),r.a.createElement(S.a,{value:5},"5 Seconds"),r.a.createElement(S.a,{value:30},"30 Seconds"),r.a.createElement(S.a,{value:60},"60 Seconds"),r.a.createElement(S.a,{value:300},"5 Minutes"),r.a.createElement(S.a,{value:900},"15 Minutes"),r.a.createElement(S.a,{value:3600},"1 Hour")),r.a.createElement(b.a,{style:{color:"white"},onClick:function(){e.setState(Object.assign(e.state,{page:"setup"}))}},r.a.createElement(O.a,null)))))),"setup"===this.state.page&&r.a.createElement(T,{store:this.store}),"dashboard"===this.state.page&&r.a.createElement(q,{store:this.store,updateIntevalSeconds:this.state.updateIntevalSeconds}))}}]),t}(n.Component);o.a.render(r.a.createElement(Y,null),document.getElementById("root"))}},[[106,2,1]]]);
//# sourceMappingURL=main.fc4fe005.chunk.js.map