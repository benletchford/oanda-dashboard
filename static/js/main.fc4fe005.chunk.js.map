{"version":3,"sources":["Setup.js","Dashboard.js","utils.js","App.js","index.js"],"names":["Setup","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","state","rows","keys","store","accessData","length","_this2","_loop","i","env","push","react_default","a","createElement","style","display","key","TextField_default","required","defaultValue","accessToken","onChange","e","target","value","label","width","accountId","Paper_default","padding","name","Button_default","variant","color","marginRight","onClick","setState","assign","marginLeft","pop","Component","fetchOandaEndpoint","url","t","v","delayJitter","Math","floor","random","Promise","resolve","setTimeout","bind","then","fetch_retry","options","n","fetch","response","ok","Error","statusText","catch","error","headers","Authorization","concat","result","json","getApiBase","getAccountsTransactions","accounts","all","map","account","jsonResult","pages","pageUrl","jsonResponse","transactions","flattenedTransactions","forEach","getAccountTransactions","getAccountsSummary","getAccountSummary","Dashboard","data","updateWindowDimensions","assertThisInitialized","transactionsByDay","transaction","type","day","moment","time","format","undefined","pl","plByDay","dayKey","reduce","b","profitByDay","sort","x","y","round","cumulativeProfitByDay","lastTotalProfit","summaries","nav","summary","unrealizedPL","results","finalResult","balance","p","mode","line","document","title","updateIntevalSeconds","_this3","clearInterval","updateInteval","setInterval","update","nextProps","makeUpdateInterval","window","addEventListener","height","textAlign","margin","react_plotly_default","layout","autosize","windowHeight","showlegend","useResizeHandler","removeEventListener","windowWidth","innerWidth","innerHeight","encodeObject","obj","btoa","unescape","encodeURIComponent","JSON","stringify","App","page","location","hash","substring","parse","decodeURIComponent","escape","atob","AppBar_default","position","Toolbar_default","Typography_default","flexGrow","IconButton_default","preventedDefault","preventDefault","ChevronRight_default","Select_default","MenuItem_default","ChevronLeft_default","src_Setup","src_Dashboard","ReactDOM","render","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.fc4fe005.chunk.js","sourcesContent":["import React, { Component } from 'react'\n\nimport TextField from '@material-ui/core/TextField'\nimport Paper from '@material-ui/core/Paper'\nimport Button from '@material-ui/core/Button'\n\nclass Setup extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      rows: Object.keys(props.store.accessData).length || 1\n    }\n  }\n\n  render() {\n    let rows = []\n    for(let i=0;i<this.state.rows;i++) {\n      if(!this.props.store.accessData[i]) this.props.store.accessData[i] = {env: 'live'}\n      rows.push(\n        <div style={{display: 'flex'}} key={i}>\n          <TextField\n            required\n            defaultValue={this.props.store.accessData[i] ? this.props.store.accessData[i].accessToken : ''}\n            onChange={(e) => this.props.store.accessData[i].accessToken = e.target.value}\n            label=\"Account Access Token\"\n            style={{width: '100%'}}\n          />\n          <TextField\n            required\n            defaultValue={this.props.store.accessData[i] ? this.props.store.accessData[i].accountId : ''}\n            onChange={(e) => this.props.store.accessData[i].accountId = e.target.value}\n            label=\"Account ID\"\n            style={{width: '100%'}}\n          />\n          <TextField\n            required\n            defaultValue={this.props.store.accessData[i] ? this.props.store.accessData[i].env : ''}\n            onChange={(e) => this.props.store.accessData[i].env = e.target.value}\n            label=\"Env\"\n            style={{width: '100%'}}\n          />\n        </div>\n      )\n    }\n\n    return (\n      <Paper>\n        <div style={{padding: '10px'}}>\n          <TextField\n            required\n            defaultValue={this.props.store.name ? this.props.store.name : ''}\n            onChange={(e) => this.props.store.name = e.target.value}\n            label=\"Dashboard Name\"\n            style={{width: '100%'}}\n          />\n        </div>\n\n        <div style={{padding: '10px'}}>\n          {rows}\n        </div>\n\n        <div style={{display: 'flex', padding: '10px'}}>\n          <Button variant=\"contained\" color=\"primary\" style={{width: '100%', marginRight: '5px'}}\n            onClick={(e) => this.setState(Object.assign(this.state, {rows: this.state.rows + 1}))}\n          >\n            Add row\n          </Button>\n          <Button variant=\"contained\" color=\"secondary\" style={{width: '100%', marginLeft: '5px'}}\n            onClick={(e) => {\n              if(this.state.rows > 1) {\n                this.setState(Object.assign(this.state, {rows: this.state.rows - 1}))\n                this.props.store.accessData.pop()\n              }\n            }}\n          >\n            Remove row\n          </Button>\n        </div>\n      </Paper>\n    )\n  }\n}\n\nexport default Setup\n","import React, { Component } from 'react'\nimport './App.css'\n\nimport * as moment from 'moment'\nimport Plot from 'react-plotly.js'\n\nimport Paper from '@material-ui/core/Paper'\n\nfunction delay(t, v) {\n   return new Promise(function(resolve) {\n       setTimeout(resolve.bind(null, v), t)\n   })\n}\n\nfunction fetch_retry(url, options, n) {\n    return fetch(url, options).then((response) => {\n      if (!response.ok) {\n          throw Error(response.statusText)\n      }\n      return response\n    }).catch((error) => {\n        if (n === 1) throw error\n        return fetch_retry(url, options, n - 1)\n    });\n}\n\nfunction fetchOandaEndpoint(url, accessToken) {\n  let delayJitter = Math.floor((Math.random() * 1000 * 2) + 1)\n  let retries = 5\n\n  return delay(delayJitter).then(function() {\n    return fetch_retry(url, {\n      headers: {\n        'Authorization': `Bearer ${accessToken}`\n      },\n    }, retries).then((result) => {\n      return result.json()\n    })\n  });\n}\n\nfunction getApiBase(env) {\n  if(env === 'practice')\n    return 'https://api-fxpractice.oanda.com'\n  else if(env === 'live')\n    return 'https://api-fxtrade.oanda.com'\n}\n\nfunction getAccountTransactions(account) {\n  let url = `${getApiBase(account.env)}/v3/accounts/${account.accountId}/transactions`\n\n  return fetchOandaEndpoint(url, account.accessToken)\n    .then((jsonResult) => {\n      return Promise.all(jsonResult.pages.map((pageUrl) => {\n        return fetchOandaEndpoint(pageUrl, account.accessToken)\n          .then((jsonResponse) => {\n            return jsonResponse.transactions\n          })\n      }))\n        .then((transactions) => {\n          let flattenedTransactions = []\n          transactions.forEach((result) => flattenedTransactions = flattenedTransactions.concat(result))\n\n          return flattenedTransactions\n        })\n    })\n}\n\nfunction getAccountsTransactions(accounts) {\n  return Promise.all(accounts.map((account) => {\n    return getAccountTransactions(account)\n  }))\n    .then((transactions) => {\n      let flattenedTransactions = []\n      transactions.forEach((result) => flattenedTransactions = flattenedTransactions.concat(result))\n\n      return flattenedTransactions\n    })\n}\n\nfunction getAccountSummary(account) {\n  let url = `${getApiBase(account.env)}/v3/accounts/${account.accountId}/summary`\n\n  return fetchOandaEndpoint(url, account.accessToken)\n}\n\nfunction getAccountsSummary(accounts) {\n  return Promise.all(accounts.map((account) => {\n    return getAccountSummary(account)\n  }))\n}\n\nclass Dashboard extends Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      data: null\n    }\n\n    this.updateWindowDimensions = this.updateWindowDimensions.bind(this)\n  }\n\n  update() {\n    return Promise.all([\n      getAccountsTransactions(this.props.store.accessData)\n      .then((transactions) => {\n        let transactionsByDay = {}\n        transactions.forEach((transaction) => {\n          if(transaction.type === \"ORDER_FILL\") {\n            let day = moment(transaction.time).format('YYYY-MM-DD')\n\n            if(transactionsByDay[day] === undefined) transactionsByDay[day] = []\n            transactionsByDay[day].push(+transaction.pl)\n          }\n        })\n\n        let plByDay = {}\n        Object.keys(transactionsByDay).forEach(dayKey => {\n          plByDay[dayKey] = transactionsByDay[dayKey].reduce((a, b) => a + b, 0)\n        })\n\n        let profitByDay = []\n        Object.keys(transactionsByDay).sort().forEach(dayKey => {\n          profitByDay.push({\n            x: dayKey,\n            y: Math.round(plByDay[dayKey] * 100) / 100\n          })\n        })\n\n        let cumulativeProfitByDay = []\n        let lastTotalProfit = 0\n        Object.keys(transactionsByDay).sort().forEach(dayKey => {\n          let y = lastTotalProfit + plByDay[dayKey]\n          lastTotalProfit = y\n\n          cumulativeProfitByDay.push({\n            x: dayKey,\n            y: Math.round(y * 100) / 100\n          })\n        })\n\n        return {\n          name: 'balance',\n          profitByDay: profitByDay,\n          cumulativeProfitByDay: cumulativeProfitByDay\n        }\n      }),\n      getAccountsSummary(this.props.store.accessData)\n        .then((summaries) => {\n          return {\n            name: 'nav',\n            nav: Math.round(100 *\n              summaries.map((summary) => +summary.account.pl + +summary.account.unrealizedPL).reduce((a, b) => a + b, 0)\n            ) / 100\n          }\n        })\n    ])\n      .then((results) => {\n        let finalResult = {}\n        results.forEach((result) => {\n          finalResult[result.name] = result\n          delete finalResult[result.name].name\n        })\n\n        return finalResult\n      })\n      .then((result) => {\n        this.setState(Object.assign(this.state, {\n          data: [\n            {\n              name: 'Balance',\n              x: result.balance.cumulativeProfitByDay.map((p) => p.x),\n              y: result.balance.cumulativeProfitByDay.map((p) => p.y),\n              mode: 'lines'\n            },\n            {\n              name: 'NAV',\n              line: {\n                  color: 'rgb(0, 194, 0)'\n              },\n              x: [\n                result.balance.cumulativeProfitByDay[result.balance.cumulativeProfitByDay.length - 2].x,\n                result.balance.cumulativeProfitByDay[result.balance.cumulativeProfitByDay.length - 1].x\n              ],\n              y: [\n                result.balance.cumulativeProfitByDay[result.balance.cumulativeProfitByDay.length - 2].y,\n                result.nav.nav\n              ]\n            }\n          ]\n        }))\n\n        document.title = this.props.store.name + ': ' + result.nav.nav\n      })\n  }\n\n  makeUpdateInterval(updateIntevalSeconds) {\n    clearInterval(this.updateInteval)\n    if(updateIntevalSeconds !== 0) {\n      this.updateInteval = setInterval(() => {\n        this.update()\n      }, 1000 * updateIntevalSeconds)\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    this.makeUpdateInterval(nextProps.updateIntevalSeconds)\n  }\n\n  componentDidMount() {\n    this.update()\n    this.makeUpdateInterval(this.props.updateIntevalSeconds)\n\n    this.updateWindowDimensions()\n    window.addEventListener('resize', this.updateWindowDimensions)\n  }\n\n  render() {\n    return (\n      <div style={{width: '100%', height: '100%'}}>\n        {!this.state.data &&\n          <div style={{textAlign: 'center', margin: '25px'}}>Loading...</div>\n        }\n        {this.state.data &&\n          <Paper>\n            <Plot\n              data={this.state.data}\n              layout={{\n                autosize: true,\n                title: this.props.store.name,\n                height: this.state.windowHeight - 64,\n                showlegend: false\n              }}\n              useResizeHandler={true}\n              style={{width: '100%'}}\n            />\n          </Paper>\n        }\n      </div>\n    )\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.updateWindowDimensions)\n    clearInterval(this.updateInteval)\n  }\n\n  updateWindowDimensions() {\n    this.setState(Object.assign(this.state, {\n      windowWidth: window.innerWidth, windowHeight: window.innerHeight\n    }))\n  }\n}\n\nexport default Dashboard\n","export function encodeObject(obj) {\n  return btoa(unescape(encodeURIComponent(JSON.stringify(obj))));\n}\nexport function decodeObject(obj) {\n  return JSON.parse(decodeURIComponent(escape(window.atob(obj))));\n}\n","import React, { Component } from 'react'\n\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Typography from '@material-ui/core/Typography'\nimport IconButton from '@material-ui/core/IconButton'\nimport ChevronRight from '@material-ui/icons/ChevronRight'\nimport ChevronLeft from '@material-ui/icons/ChevronLeft'\nimport Select from '@material-ui/core/Select';\nimport MenuItem from '@material-ui/core/MenuItem';\n\nimport Setup from './Setup'\nimport Dashboard from './Dashboard'\n\nimport { encodeObject, decodeObject } from './utils.js'\n\nclass App extends Component {\n  constructor(props) {\n    super(props)\n\n    this.store = {\n      accessData: [],\n      name: ''\n    }\n    this.state = {\n      page: 'setup',\n      updateIntevalSeconds: 0\n    }\n  }\n\n  componentWillMount() {\n    if(window.location.hash) {\n      this.store = decodeObject(window.location.hash.substring(1))\n      this.setState(Object.assign(this.state, {\n        page: 'dashboard',\n        updateIntevalSeconds: this.store.updateIntevalSeconds || this.state.updateIntevalSeconds\n      }))\n    }\n  }\n\n  render() {\n    return(\n      <div>\n        <AppBar position=\"static\">\n          <Toolbar>\n            <Typography variant=\"title\" color=\"inherit\">\n              {this.state.page === 'setup' && 'Oanda Dashboard Setup'}\n              {this.state.page === 'dashboard' && 'Oanda Dashboard'}\n            </Typography>\n            <div style={{flexGrow: 1}}></div>\n            <div>\n              {this.state.page === 'setup' && (\n                <IconButton style={{color: 'white'}} onClick={(e) => {\n                  let preventedDefault = false\n                  for(let i=0;i<this.store.accessData.length;i++) {\n                    if(!this.store.accessData[i].accessToken ||\n                      !this.store.accessData[i].accountId ||\n                      !this.store.accessData[i].env) {\n                        e.preventDefault()\n                        preventedDefault = true\n                    }\n                  }\n                  if(!this.store.name) {\n                    e.preventDefault()\n                    preventedDefault = true\n                  }\n\n                  if(!preventedDefault) {\n                    window.location.hash = encodeObject(this.store)\n                    this.setState(Object.assign(this.state, {\n                      page: 'dashboard'\n                    }))\n                  }\n                }}>\n                  <ChevronRight />\n                </IconButton>\n              )}\n              {this.state.page === 'dashboard' && (\n                <div>\n                  <Select\n                    value={this.state.updateIntevalSeconds}\n                    onChange={(e) => {\n                      this.store.updateIntevalSeconds = e.target.value\n                      window.location.hash = encodeObject(this.store)\n\n                      this.setState(Object.assign(this.state, {\n                        updateIntevalSeconds: e.target.value\n                      }))\n                    }}\n                  >\n                    <MenuItem value={0}>Never</MenuItem>\n                    <MenuItem value={5}>5 Seconds</MenuItem>\n                    <MenuItem value={30}>30 Seconds</MenuItem>\n                    <MenuItem value={60}>60 Seconds</MenuItem>\n                    <MenuItem value={60*5}>5 Minutes</MenuItem>\n                    <MenuItem value={60*15}>15 Minutes</MenuItem>\n                    <MenuItem value={60*60}>1 Hour</MenuItem>\n                  </Select>\n                  <IconButton style={{color: 'white'}} onClick={() => {\n                    this.setState(Object.assign(this.state, {\n                      page: 'setup'\n                    }))\n                  }}>\n                    <ChevronLeft />\n                  </IconButton>\n                </div>\n              )}\n            </div>\n          </Toolbar>\n        </AppBar>\n\n        {this.state.page === 'setup' && <Setup store={this.store} />}\n        {this.state.page === 'dashboard' && <Dashboard store={this.store} updateIntevalSeconds={this.state.updateIntevalSeconds} />}\n      </div>\n    )\n  }\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n\nReactDOM.render((<App />), document.getElementById('root'))\n"],"sourceRoot":""}